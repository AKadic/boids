name: Build and publish

on: push

jobs:
  build:
    name: Build and publish Python ðŸ distributions ðŸ“¦ to TestPyPI
    strategy:
      matrix:
        # os: [macos-latest, ubuntu-latest, windows-latest]
        os: [macos-latest, windows-latest]
    runs-on: ${{ matrix.os }}
    steps:
    - uses: actions/checkout@master
    # - name: Configure Linux
    #   run: |
    #     if [ "$RUNNER_OS" == "Linux" ]; then
    #           sudo apt-get install -y  libgl1-mesa-dev libxrandr-dev libxinerama-dev libxcursor-dev libxi-dev
    #     fi
    #   shell: bash
    - name: Set up Python 3.10
      uses: actions/setup-python@v3
      with:
        python-version: "3.10"
    - name: Install pypa/build
      run: >-
        python -m
        pip install
        build
        --user
    - name: Build a binary wheel
      run: >-
        python -m
        build
        --wheel
        --outdir dist/
        ./engine
    - name: Install twine
      run: >-
        python -m 
        pip install 
        twine
        --user
    - name: Publish distribution ðŸ“¦ to Test PyPI
      run: >-
        python -m 
        twine upload --repository testpypi
        dist/* 
        -u __token__
        -p ${{ secrets.TEST_PYPI_API_TOKEN }}
